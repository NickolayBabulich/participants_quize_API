# Participants API

Проект представляет собой backend приложения, предназначенного для работы с регистрацией участников квиза.


## Технологии

- [![Python](https://img.shields.io/badge/-Python-3776AB?style=flat&logo=python&logoColor=white)](https://www.python.org/) [![Django](https://img.shields.io/badge/-Django-092E20?style=flat&logo=django&logoColor=white)](https://www.djangoproject.com/) [![Django Rest Framework](https://img.shields.io/badge/-Django_Rest_Framework-092E20?style=flat)](https://www.django-rest-framework.org/)
- [![PostgreSQL](https://img.shields.io/badge/-PostgreSQL-336791?style=flat&logo=postgresql&logoColor=white)](https://www.postgresql.org/)
- [![Gunicorn](https://img.shields.io/badge/-Gunicorn-589636?style=flat&logo=gunicorn&logoColor=white)](https://gunicorn.org/) [![NGINX](https://img.shields.io/badge/-NGINX-269539?style=flat&logo=nginx&logoColor=white)](https://www.nginx.com/)
- [![Docker](https://img.shields.io/badge/-Docker-2496ED?style=flat&logo=docker&logoColor=white)](https://www.docker.com/)

## Описание

Participants API разработан для управления данными зарегистрированных участников. Проект представляет API эндпоинт для
регистрации
участников, подтверждение участника по номеру телефона, выдачу результата выйгрыша приза тому или иному участнику, а также позволяем управлять данными через административный интерфейс Django.

Изначальное ТЗ было представлено разработкой API эндпоинта для регистрации данных участника квиза, в процессе разработки
были добавлены дополнительные функции представленные в виде кастомных действий в админке Django, такие как отправка
данных на сторонний
API, выгрузка данных в форматах CSV и Excel, подтверждение номера телефона смской через сервис SMSAero (в репозитории заменен на фейковую отправку), подведение итогов загрузкой списков победителей конкурса и выводом результата по номеру телефона.

Логика работы:
- Валидация данных сделана на фронте, обработка ошибок также
- Пользователю было предложено заполнить форму для регистрации в последующем розыгрыше призов, кнопка зарегистрироваться не доступна до момента подтверждения номера телефона (валидация заложена на фронте)
  - эндпоинт - POST - ```/api/participants/create/```
  - параметры:
    - first_name - Имя
    - second_name - Фамилия
    - patronymic - Отчетсво
    - birthday - дата рождения (20.05.1985)
    - address - Адрес
    - email - Почта (уникальное)
    - phone - Телефон (уникальное, валидировался на фронте)
![main.png](tmp%2Fmain.png)
- По ходу заполнения данными вписав номер телефона пользователю требовалось подтвердить его(происходит отправка 4х значного кода подтверждения на номер телефона пользователя, в админке Django модель Phone verifys служит что-то в виде кэш данных)
  - эндпоинт - POST - ```/api/participants/phone_verify/```
  - параметры:
    - phone - Телефон (уникальное, валидировался на фронте, 89091231212)
- Далее в форме пользователю необходимо ввести подтверждающий код из смс
  - эндпоинт - POST - ```/api/participants/code/verify/```
  - параметры:
    - phone - Телефон (уникальное, валидировался на фронте, 89091231212)
    - code - Код подтверждения из смс
![verify.png](tmp%2Fverify.png)
- После подтверждения доступна кнопка регистрации, нажимая кнопку пользователь попадает в базу данных Participants, в поле Verify проставляется таймстемп с датой и временем верификации пользователя, а из кэш базы данных Phone verifys удаляются его данные так как номер успешно подтвержден и пользователь был зарегистрирован
- По ТЗ данные необходимо было отправлять на эндпоинт основного федерального оператора данного розыгрыша, в сервисе представлена модель Test sendings для имитации отправки данных
- Отправка данных участников осуществляется через админку в разделе Participants, необходимо выбрать данные и в действиях выбрать Отправить данные
- При успешной отправки данных у пользователя проставляется таймстемп и статус True, а также в разделе Logs фиксируются данные отправки
- Также присутствуют такие действия как выгрузка в CSV и EXCEL данных с участниками
- Финал реализации проекта:
- Федеральным оператором на основе предоставленных данных подводились итоги розыгрыша и распределение выигрышей по ID номерам зарегистрированных пользователей, по итогу региональному оператору отправлялся файл CSV с победителями
- Необходимо загрузить данные CSV файла с победителями в docker контейнере выполнить ```python3 manage.py load_data```
- В таблицу Winnerss будут добавлены все сопоставленные ID с выйгрышами и ID из таблицы Participants
- В таблице Participants реализовано действие для рассылки смс об уведомление итогах розыгрыша
- По итогам на сайте пользователь может проверить свой выйгрыщ введя 4 цифры своего номер телефона
  - эндпоинт - GET - ```/api/participants/winners?phone=0123```
  - параметры:
    - phone - последние 4 цифры телефона
![winners all.png](tmp%2Fwinners%20all.png)
![winner.png](tmp%2Fwinner.png)


## Установка
- Для начала работы с проектом клонируйте репозиторий
- Произвести установку Docker (https://docs.docker.com/get-docker/)
- Запуск проекта производится командой ```docker compose up```


## Дополнительно
- Управление данными осуществляется с помощью админки Django ```/admin/```
  - логин - admin
  - пароль - 1